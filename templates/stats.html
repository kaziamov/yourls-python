{% extends "base.html" %}

{% block title %}Stats for {{ link.keyword }}{% endblock %}

{% block content %}
    <h2>Statistics for Short URL: {{ link.keyword }}</h2>

    <div class="stats-summary">
        <p>
            <strong>Original URL:</strong> 
            <a href="{{ link.url }}" title="{{ link.url }}">{{ link.url | truncate(80) }}</a>
        </p>
        <p>
            <strong>Title:</strong> 
            {{ link.title | default('<em>No title provided</em>') | safe }}
        </p>
        <p>
            <strong>Short URL:</strong> 
            {# Assuming the app runs at the root #}
            <a href="{{ url_for('redirect_link', keyword=link.keyword, _external=True) }}">{{ url_for('redirect_link', keyword=link.keyword, _external=True) }}</a>
        </p>
        <p>
            <strong>Date Created:</strong> 
            {{ link.timestamp | dateformat('%Y-%m-%d %H:%M:%S') }}
        </p>
        <p>
            <strong>Total Clicks:</strong> 
            {{ link.clicks | numberformat }}
        </p>
    </div>

    {# Placeholder for detailed click log table/chart - Replaced below #}
    <div class="detailed-stats">
        <h3>Recent Click History (Last 100)</h3>
        
        {% if logs %}
            <table class="click-log-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Referrer</th>
                        <th>User Agent</th>
                        <th>IP Address</th>
                        {# <th>Country</th> #} {# Uncomment when GeoIP is added #}
                    </tr>
                </thead>
                <tbody>
                    {% for log_entry in logs %}
                        <tr>
                            <td>{{ log_entry.click_time | dateformat('%Y-%m-%d %H:%M:%S') }}</td>
                            <td>
                                {% if log_entry.referrer %}
                                    <a href="{{ log_entry.referrer }}" target="_blank" rel="noopener noreferrer" title="{{ log_entry.referrer }}">
                                        {{ log_entry.referrer | truncate(50) }}
                                    </a>
                                {% else %}
                                    <em>Direct</em>
                                {% endif %}
                            </td>
                            <td title="{{ log_entry.user_agent }}">{{ log_entry.user_agent | truncate(60) }}</td>
                            <td>{{ log_entry.ip_address }}</td>
                            {# <td>{{ log_entry.country_code or 'N/A' }}</td> #}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p><em>No clicks recorded yet for this link.</em></p>
        {% endif %}
    </div>

    <p><a href="{{ url_for('admin_index') }}">&laquo; Back to Admin Index</a></p>

{% endblock %} 